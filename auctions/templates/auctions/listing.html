{% extends "auctions/layout.html" %}

{% block title %}
    Listing: {{ listing.title }}
{% endblock %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link" href="{% url 'index' %}">Active Listings</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'listings' %}">All Listings</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'create' %}">Create Listing</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'watchlist' %}">Watchlist</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'categories' %}">All Categories</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'logout' %}">Log Out</a>
    </li>
{% endblock %}

{% block body %}
    <h1>{{ listing.title }}</h1>

    {% if listing.image != "" %}
        <img src="{{ listing.image }}" height="100">
    {% endif %}
    <p>Created by: {{ listing.user.username }}</br>
       Current Bid: {{ listing.price }}</br>
       Description: {{ listing.description }}</br>
    
    {% if listing.categories %}
        Categories: 
        {% for category in listing.categories.all %}
            {{ category.category }}
        {% endfor %}
    {% endif %}
    
    </p>
    {% if user.is_authenticated %}
        {% if listing.active == True %}

            <form action="/add_to_watchlist/{{ listing.id }}" method="post">
                {% csrf_token %}
                <input type="submit" value="Add to Watchlist">
            </form>

            {% if listing.user != user %}
                <form action="/listing/{{ listing.id }}" method="post">
                    {% csrf_token %}
                    <input type="number" name="amount" step="0.01" min="{{ listing.price }}">
                    <input type="submit" value="Place Bid">
                </form>
            {% endif %}

            {% if listing.user == user %}
                <form action="/close_listing/{{ listing.id }}" method="post">
                    {% csrf_token %}
                    <input type="submit" value="Close Listing">
                </form>
            {% endif %}

        {% else %}
            -- BIDDING CLOSED -- </br>
            {% if winner.user == user %}
                You Won! (See email for details on how to proceed.)
            {% else %}
                Winner: {{ winner.user.username }}
            {% endif %}
        {% endif %}

        {% if listing.active == True %}
            <form action="/comment/{{ listing.id }}" method="post">
                {% csrf_token %}
                {{ comment_form }}
                <input type="submit" value="Submit">
            </form>
        {% endif %}

        <h2>Comments</h2>
        <ul>
            {% for comment in comments %}
                {% if comment.anonymous == True %}
                <li>Anonymous: {{ comment.comment }}</li>
                {% else %}
                <li>{{ comment.user.username }}: {{ comment.comment }}</li>
                {% endif %}
            {% endfor %}
        </ul>

    {% endif %}


{% endblock %}