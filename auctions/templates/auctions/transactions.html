{% extends "auctions/layout.html" %}

{% load tz %}

{% block title %}
    Transactions
{% endblock %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link" href="{% url 'index' %}">Active Listings</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'listings' %}">All Listings</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'create' %}">Create Listing</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'watchlist' %}">Watchlist</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'categories' %}">All Categories</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'messages' current_user.id %}">Messages</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{% url 'profile' current_user.id %}">My Yard</a>
    </li>
{% endblock %}


{% block body %}

<div class="page-content">
    <h2>{{ current_user.username }}'s Transaction History</h2>
    <table class="table table-striped transactions-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Amount</th>
                <th>Sender</th>
                <th>Recipient</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.date|date:"F j, Y, g:i a" }}</td>
                {% if transaction.listing %}
                    <td><a href="{% url 'listing' transaction.listing.id %}">{{ transaction.listing.title }}</a></td>
                {% else %}
                    <td>N/A</td>
                {% endif %}
                {% if transaction.sender == user %}
                <td class="withdraw-amt">-${{ transaction.amount }}</td>
                <td>You</td>
                <td>{{ transaction.recipient }}</td>
                {% else %}
                <td class="deposit-amt">${{ transaction.amount }}</td>
                <td>{{ transaction.sender }}</td>
                <td>You</td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="center-container">
        <p>Your current balance is: {{ current_user.balance }}</p>
    </div>

    <div class="center-container">
        <hr>
    </div>

    <h2>{{ current_user.username }}'s Bid History</h2>
    <table class="table table-striped transactions-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Amount</th>
                <th>Active/Closed</th>
                <th>Wining Bid?</th>
            </tr>
        </thead>
        <tbody>
            {% for bid in user_bids %}
            {% if bid.listing.active == True and bid.amount == bid.listing.price %}
                <tr class="winning-bid-active">
            {% elif bid.listing.active == False and bid.amount == bid.listing.price %}
                <tr class="winning-bid-closed">
            {% elif bid.listing.active == True and bid.amount != bid.listing.price %}
                <tr class="losing-bid-active">
            {% elif bid.listing.active == False and bid.amount != bid.listing.price %}
                <tr class="losing-bid-closed">
            {% endif %}
                <td>{{ bid.date|date:"F j, Y, g:i a" }}</td>
                    <td><a href="{% url 'listing' bid.listing.id %}">{{ bid.listing.title }}</a></td>
                <td class="bid-amt">${{ bid.amount }}</td>
                <td>
                    {% if bid.listing.active == True %}
                        Active
                    {% else %}
                        Closed
                    {% endif %}
                </td>
                <td class="winning-bid">
                    {% if bid.listing.active == True %}
                        N/A
                    {% else %}
                        {% if bid.listing.winner == user %}
                            Yes
                        {% else %}
                            No
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="center-container">
        <p>You have {% if active_bid_count == 0 %}no{% else %}{{ active_bid_count }}{% endif %} active bids.</p>
    </div>

    <a href="{% url 'profile' current_user.id %}" class="btn btn-primary">Back to Profile</a>
</div>

{% endblock %}